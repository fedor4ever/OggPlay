/*
AutoConvert, a Chinese HZ/GB/Big5 encodings auto-converter
Copyright (C) 1999  于广辉  Yu Guanghui <ygh@debian.org>

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or any
later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330,
Boston, MA  02111-1307, USA.
*/
/* 
* author: Yu Guanghui <ygh@debian.org>
*	  Network Center
* 	  Dalian Univ. of Tech.	
*	  1999.5
*/

/*
 *Author: Ha Shao <hashao@china.com>
 *Date:	2000.08.30
 */
 /*$Header$*/

/* Judge Encoding based on character frequency.
 * We will use 2 hash tables generated from GNU gperf
 */

//$Header$
#include <stdio.h>
#include <string.h>
//#include "zhstatis.h"
#include "Utf8Fix.h"

/////////////////////////////////////////////////
// Locals
//

// not used, #define GBTOPPER        3.500849        /* Top GB frequency. */
// not used, #define B5TOPPER        3.803567        /* Top Big5 frequency. */
// not used, #define MAX_MODULE      16
// not used, #define MAX_BUFFER      8192

struct charHz { char *name; double percent; };

/////////////////////////////////////////////////
// Local Function Prototypes
//

static unsigned int         b5Hash ( register const char *str, register unsigned int len );
static unsigned int         gbHash ( register const char *str, register unsigned int len );
static const struct charHz* inBig5( register const char *str, register unsigned int len );
static const struct charHz* inGB( register const char *str, register unsigned int len );
static int                  j_code3( const char * buff, int count );

/* ANSI-C code produced by gperf version 2.7.1 (19981006 egcs) */
/* Command-line: gperf -L ANSI-C -I -t -H gbHash -N inGB -C -E -o -n -c -D gbpercent.txt  */
/****************************************************
 400 Most frequently used GB chars. 
 ****************************************************/
/* maximum key range = 991, duplicates = 5 */

/////////////////////////////////////////////////
// Global Functions
//

int j_code(const char * buff,int count)
{
	const unsigned char * phz;
	int c_gb=0;
	int c_big5=0;

	char HZ_START[]="~{";
	char HZ_END[]="~}";


/* first we look up "我"  and "的" ,both gb and big5
 * in the text.
 */
	for(phz=(unsigned char * /*FIXIT*/)buff;phz<((unsigned char * /*FIXIT*/)buff+count);phz++){
		if(*phz & 0x80){
			if((*phz==0xB5&&*(phz+1)==0xC4) || ((*phz==0xCE)&&*(phz+1)==0xD2)){
				c_gb++;
				phz++;
				continue;
			}else if((*phz==0xAA&&*(phz+1)==0xBA)|| ((*phz==0xA7)&&*(phz+1)==0xDA)){
				c_big5++;
				phz++;
				continue;
			}
			phz++;
		}
	}

	if(c_gb > c_big5){
		return GB_CODE;
	}else if (c_gb ==  c_big5){ //c_gb == 0,c_big5==0
		if(strstr(buff,HZ_START)!=NULL && strstr(buff,HZ_END)!=NULL){
			return HZ_CODE;
		}
		/*There is not "我" and "的" in the text
		 *So we test the text with a 400 words table.
		 */
		return j_code3(buff,count);		
	}else{
		return BIG5_CODE;
	}
}

/////////////////////////////////////////////////
// Local Functions
//

#ifdef __GNUC__
__inline
#endif
static unsigned int
gbHash (register const char *str, register unsigned int len)
{
  static const unsigned short asso_values[] =
    {
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991, 991, 991, 991, 991, 991, 991, 991, 991, 991,
      991,  91, 425, 320, 148,  70, 510,  85, 203, 160,
        6,  18, 480, 223, 113, 345,  28, 120, 320, 390,
       75,  20, 275, 380, 230,  50, 433,  15, 145,   5,
      455, 460, 163, 180, 338,  40,   8, 508, 510,  45,
      325,  85,  30, 140, 105, 305,   3, 225, 100, 403,
      113, 480,  25, 205,   0, 250, 393, 371,  63, 260,
      268, 991,  10, 470, 405, 268, 348,  76, 285, 131,
      408, 398, 991, 125, 330, 126, 388, 503,  51, 148,
      350,  46,   1, 166,  15,  16, 485, 106, 458,  41,
      103, 221,  21,  61, 500, 991
    };
  return asso_values[(unsigned char)str[len - 1]] + asso_values[(unsigned char)str[0]];
}

#ifdef __GNUC__
__inline
#endif
static const struct charHz *
inGB (register const char *str, register unsigned int len)
{
  enum
    {
      TOTAL_KEYWORDS = 400,
      MIN_WORD_LENGTH = 2,
      MAX_WORD_LENGTH = 2,
      MIN_HASH_VALUE = 0,
      MAX_HASH_VALUE = 990
    };

  static const struct charHz wordlist[] =
    {
      {"种",	0.151748},
      {"治",	0.062792},
      {"知",	0.176508},
      {"为",	0.442767},
      {"文",	0.214763},
      {"无",	0.213959},
      {"只",	0.229438},
      {"或",	0.085280},
      {"位",	0.128747},
      {"交",	0.073778},
      {"华",	0.094296},
      {"将",	0.168043},
      {"到",	0.514231},
      {"近",	0.063487},
      {"的",	3.500849},
      {"手",	0.211674},
      {"元",	0.071841},
      {"问",	0.140707},
      {"式",	0.057680},
      {"但",	0.167690},
      {"怎",	0.072121},
      {"话",	0.146944},
      {"术",	0.070839},
      {"务",	0.081974},
      {"实",	0.156769},
      {"今",	0.083052},
      {"那",	0.382771},
      {"没",	0.244614},
      {"基",	0.057849},
      {"毛",	0.075090},
      {"得",	0.396983},
      {"命",	0.093383},
      {"众",	0.058726},
      {"还",	0.233198},
      {"活",	0.092784},
      {"公",	0.188655},
      {"倒",	0.054738},
      {"内",	0.111181},
      {"前",	0.200232},
      {"是",	1.345411},
      {"打",	0.129442},
      {"次",	0.121678},
      {"未",	0.054546},
      {"使",	0.118288},
      {"第",	0.123170},
      {"你",	0.436374},
      {"们",	0.495768},
      {"民",	0.174189},
      {"在",	0.964866},
      {"山",	0.103285},
      {"数",	0.091243},
      {"传",	0.063780},
      {"点",	0.152685},
      {"中",	0.717652},
      {"甚",	0.058755},
      {"色",	0.074190},
      {"叫",	0.089328},
      {"主",	0.204736},
      {"心",	0.273937},
      {"西",	0.117537},
      {"教",	0.117812},
      {"过",	0.327524},
      {"之",	0.327879},
      {"因",	0.127394},
      {"么",	0.276714},
      {"我",	1.014949},
      {"机",	0.137512},
      {"要",	0.370943},
      {"直",	0.075193},
      {"条",	0.064573},
      {"太",	0.103034},
      {"性",	0.095783},
      {"声",	0.151640},
      {"一",	1.703619},
      {"市",	0.101242},
      {"神",	0.091301},
      {"业",	0.134539},
      {"五",	0.103181},
      {"被",	0.126292},
      {"深",	0.060073},
      {"以",	0.349432},
      {"当",	0.222406},
      {"爱",	0.073591},
      {"十",	0.211422},
      {"员",	0.097189},
      {"明",	0.152480},
      {"四",	0.123866},
      {"时",	0.412130},
      {"物",	0.078221},
      {"国",	0.624527},
      {"半",	0.061338},
      {"书",	0.098381},
      {"钱",	0.055097},
      {"说",	0.508134},
      {"它",	0.075883},
      {"极",	0.055787},
      {"运",	0.061514},
      {"听",	0.115919},
      {"八",	0.075698},
      {"情",	0.143753},
      {"请",	0.073937},
      {"及",	0.083070},
      {"写",	0.056349},
      {"清",	0.078525},
      {"代",	0.104545},
      {"至",	0.079151},
      {"林",	0.074843},
      {"所",	0.197660},
      {"道",	0.421135},
      {"两",	0.176988},
      {"联",	0.064201},
      {"生",	0.343557},
      {"记",	0.077728},
      {"小",	0.293018},
      {"世",	0.114808},
      {"留",	0.063376},
      {"便",	0.128778},
      {"工",	0.149985},
      {"行",	0.203868},
      {"她",	0.305242},
      {"美",	0.152936},
      {"建",	0.074596},
      {"战",	0.076361},
      {"求",	0.059639},
      {"李",	0.057653},
      {"此",	0.158364},
      {"算",	0.073128},
      {"花",	0.065122},
      {"即",	0.059687},
      {"六",	0.070030},
      {"达",	0.061845},
      {"现",	0.169370},
      {"向",	0.143764},
      {"江",	0.058127},
      {"指",	0.068890},
      {"令",	0.055467},
      {"南",	0.074475},
      {"收",	0.055267},
      {"体",	0.100845},
      {"来",	0.642527},
      {"北",	0.113407},
      {"大",	0.670268},
      {"义",	0.072306},
      {"系",	0.085791},
      {"原",	0.089937},
      {"字",	0.074014},
      {"更",	0.087664},
      {"水",	0.102945},
      {"展",	0.063943},
      {"转",	0.059482},
      {"家",	0.324818},
      {"些",	0.166013},
      {"名",	0.142495},
      {"正",	0.143041},
      {"周",	0.062711},
      {"该",	0.063875},
      {"果",	0.084231},
      {"结",	0.070334},
      {"自",	0.340950},
      {"能",	0.253537},
      {"白",	0.089789},
      {"资",	0.066471},
      {"会",	0.342850},
      {"思",	0.068379},
      {"流",	0.067758},
      {"武",	0.061514},
      {"技",	0.058356},
      {"东",	0.121345},
      {"亲",	0.084066},
      {"受",	0.084736},
      {"对",	0.311761},
      {"远",	0.066691},
      {"最",	0.134213},
      {"死",	0.089264},
      {"识",	0.056331},
      {"万",	0.101912},
      {"台",	0.078054},
      {"上",	0.636581},
      {"里",	0.300629},
      {"轻",	0.058334},
      {"干",	0.076271},
      {"儿",	0.146378},
      {"管",	0.067145},
      {"了",	1.283668},
      {"王",	0.084392},
      {"报",	0.094190},
      {"步",	0.060622},
      {"任",	0.079391},
      {"感",	0.088464},
      {"跟",	0.065369},
      {"不",	1.307755},
      {"各",	0.080068},
      {"年",	0.402590},
      {"然",	0.251950},
      {"住",	0.097438},
      {"全",	0.151277},
      {"等",	0.136630},
      {"往",	0.064102},
      {"安",	0.090869},
      {"什",	0.130740},
      {"想",	0.217789},
      {"解",	0.081322},
      {"金",	0.088088},
      {"作",	0.224425},
      {"德",	0.055379},
      {"化",	0.107695},
      {"他",	0.826706},
      {"月",	0.152597},
      {"让",	0.073580},
      {"见",	0.196038},
      {"事",	0.229908},
      {"共",	0.077287},
      {"提",	0.088749},
      {"几",	0.135949},
      {"革",	0.060397},
      {"分",	0.168552},
      {"夫",	0.067138},
      {"利",	0.084762},
      {"方",	0.202303},
      {"三",	0.185462},
      {"老",	0.182608},
      {"持",	0.053845},
      {"象",	0.078045},
      {"重",	0.126537},
      {"去",	0.330934},
      {"再",	0.117460},
      {"光",	0.084711},
      {"百",	0.072738},
      {"却",	0.105046},
      {"呢",	0.056342},
      {"界",	0.083728},
      {"变",	0.064229},
      {"回",	0.156121},
      {"车",	0.089804},
      {"党",	0.054791},
      {"难",	0.092669},
      {"地",	0.430809},
      {"吃",	0.072425},
      {"办",	0.061534},
      {"电",	0.125012},
      {"都",	0.252867},
      {"产",	0.103862},
      {"非",	0.068245},
      {"言",	0.064196},
      {"间",	0.131700},
      {"把",	0.158959},
      {"也",	0.412956},
      {"候",	0.061082},
      {"城",	0.060972},
      {"何",	0.088065},
      {"新",	0.131476},
      {"保",	0.061942},
      {"满",	0.057693},
      {"关",	0.112545},
      {"样",	0.169738},
      {"比",	0.097747},
      {"面",	0.188836},
      {"青",	0.067301},
      {"入",	0.103631},
      {"题",	0.074605},
      {"反",	0.087462},
      {"少",	0.112757},
      {"院",	0.064434},
      {"父",	0.060794},
      {"意",	0.161359},
      {"进",	0.161229},
      {"人",	1.081233},
      {"开",	0.211932},
      {"目",	0.094628},
      {"别",	0.100654},
      {"觉",	0.075649},
      {"好",	0.253067},
      {"成",	0.232004},
      {"军",	0.104464},
      {"定",	0.141283},
      {"又",	0.202277},
      {"场",	0.098824},
      {"社",	0.071268},
      {"接",	0.076121},
      {"学",	0.313110},
      {"士",	0.059531},
      {"天",	0.262760},
      {"程",	0.058312},
      {"特",	0.075691},
      {"每",	0.067385},
      {"区",	0.059983},
      {"强",	0.060747},
      {"通",	0.095327},
      {"制",	0.081732},
      {"必",	0.060990},
      {"平",	0.116858},
      {"已",	0.183761},
      {"总",	0.099417},
      {"用",	0.208392},
      {"口",	0.119434},
      {"黄",	0.055445},
      {"望",	0.075475},
      {"权",	0.064165},
      {"日",	0.238170},
      {"带",	0.065223},
      {"看",	0.216015},
      {"长",	0.176671},
      {"师",	0.098604},
      {"于",	0.237050},
      {"可",	0.310500},
      {"门",	0.123004},
      {"先",	0.103316},
      {"认",	0.073529},
      {"这",	0.748073},
      {"从",	0.181841},
      {"功",	0.069931},
      {"下",	0.366675},
      {"由",	0.106073},
      {"领",	0.063793},
      {"脸",	0.055222},
      {"期",	0.089414},
      {"本",	0.197245},
      {"己",	0.148374},
      {"有",	0.846428},
      {"法",	0.158459},
      {"处",	0.099988},
      {"身",	0.167521},
      {"边",	0.077498},
      {"派",	0.057761},
      {"司",	0.084963},
      {"论",	0.072820},
      {"后",	0.297066},
      {"度",	0.074446},
      {"许",	0.075854},
      {"立",	0.093914},
      {"与",	0.165147},
      {"信",	0.114573},
      {"笑",	0.096279},
      {"真",	0.116060},
      {"京",	0.082472},
      {"动",	0.178348},
      {"女",	0.141049},
      {"表",	0.090741},
      {"加",	0.109685},
      {"语",	0.057889},
      {"相",	0.122566},
      {"完",	0.060534},
      {"告",	0.058129},
      {"量",	0.059348},
      {"件",	0.090981},
      {"息",	0.056893},
      {"外",	0.167708},
      {"计",	0.085688},
      {"合",	0.087272},
      {"连",	0.067046},
      {"眼",	0.101187},
      {"空",	0.058894},
      {"理",	0.154598},
      {"者",	0.145362},
      {"经",	0.189995},
      {"多",	0.270297},
      {"头",	0.189444},
      {"给",	0.136868},
      {"力",	0.138951},
      {"统",	0.074402},
      {"高",	0.162739},
      {"很",	0.134687},
      {"政",	0.120122},
      {"常",	0.089189},
      {"张",	0.093070},
      {"个",	0.594848},
      {"路",	0.089668},
      {"走",	0.125810},
      {"如",	0.201591},
      {"子",	0.441396},
      {"而",	0.260181},
      {"做",	0.086397},
      {"和",	0.440206},
      {"并",	0.111459},
      {"海",	0.119826},
      {"队",	0.066006},
      {"着",	0.335011},
      {"就",	0.389616},
      {"二",	0.155393},
      {"风",	0.076789},
      {"部",	0.143537},
      {"同",	0.187525},
      {"其",	0.152385},
      {"发",	0.232956},
      {"红",	0.063231},
      {"才",	0.099303},
      {"马",	0.093403},
      {"快",	0.064661},
      {"起",	0.235155},
      {"出",	0.425756},
      {"服",	0.075191},
      {"放",	0.087173},
      {"品",	0.059628},
      {"英",	0.057878},
      {"决",	0.062792},
      {"九",	0.096854},
      {"气",	0.114705},
      {"科",	0.072145},
      {"七",	0.061058},
      {"应",	0.089767}
    };

  static const short lookup[] =
    {
         0,   -1,   -1,    1,   -1,   -1,    2,   -1,
        -1,    3,   -1,    4,   -1,    5,   -1,    6,
         7,   -1,    8,   -1,    9,   10,   -1,   11,
        -1,   12,   13,   -1,   14,   -1,   15,   16,
        -1,   17,   -1,   18,   -1,   -1,   19,   -1,
        -1,   20,   -1,   21,   -1,   -1,   22,   -1,
        -1,   23,   24,   25,   -1,   26,   -1,   27,
        28,   -1,   29,   -1,   30,   31,   -1,   32,
        -1,   33,   34,   -1,   35,   -1,   36,   37,
        -1,   38,   -1,   39,   40,   -1, -482,   -1,
        43, -359,   -2,   44,   45,   46,   47,   -1,
        48,   -1,   49,   50,   -1,   51,   -1,   -1,
        52,   -1,   -1,   -1,   53,   54,   -1,   55,
        -1,   56,   57,   -1,   58,   59,   60,   61,
        -1,   62,   63,   64,   65,   -1,   66,   67,
        68,   69,   -1,   70,   -1,   71,   72,   -1,
        73,   -1,   74,   75,   -1,   76,   77,   78,
        79,   -1,   80,   -1,   81,   82,   -1,   83,
        -1,   84,   85,   -1,   86,   -1,   87,   88,
        -1,   89,   90,   91,   -1,   -1,   92,   -1,
        93,   94,   -1,   95,   -1,   96,   97,   -1,
        98,   -1,   99,  100,   -1,  101,   -1,  102,
       103,   -1,  104,   -1, -605,  107,   -1,  108,
        -1,  109,  110,   -1,  111,   -1,  112,  113,
        -1,  114,   -1,  115,  116,   -1,  117,   -1,
       118,  119,   -1,  120, -295,   -2,   -1,   -1,
       121,   -1,  122,  123,   -1,   -1,  124,  125,
       126,   -1,  127,   -1,  128,  129,   -1,  130,
        -1,  131,  132,   -1,  133,   -1,  134,  135,
        -1,  136,   -1,  137,  138,   -1,  139,   -1,
       140,  141,   -1,   -1,  142,  143,   -1,   -1,
       144,   -1,  145,  146,   -1,  147,   -1,  148,
       149,   -1,  150,   -1,  151,  152,   -1,   -1,
        -1,   -1,  153,   -1,  154,   -1,  155,  156,
        -1,  157,   -1,  158,  159,   -1,  160,   -1,
       161,   -1,   -1,  162,   -1,  163,  164,   -1,
       165,   -1,  166,   -1,   -1,  167,   -1,  168,
        -1,   -1,  169,   -1, -727,  172,   -1,  173,
        -1,  174,  175,   -1,  176,   -1,  177,  178,
        -1,  179,   -1,  180,  181,   -1,  182,   -1,
       183,  184,   -1,  185,   -1,  186, -230,   -2,
       187,   -1,  188,   -1,   -1,  189,   -1,  190,
       191,   -1,  192,   -1,  193,  194,   -1,  195,
        -1,  196,  197,   -1,  198,   -1,  199,  200,
        -1,  201,   -1,  202,  203,   -1,  204,   -1,
       205,  206,   -1,  207,   -1,  208,  209,   -1,
       210,   -1,  211,   -1,   -1,  212,   -1,  213,
        -1,   -1,  214,   -1,  215,  216,   -1,   -1,
       217,  218,  219,   -1,  220,   -1,  221,  222,
        -1,  223,   -1,  224,  225,   -1,  226,  227,
       228,  229,   -1,  230,   -1,  231,   -1,   -1,
       232,   -1, -822,  235,   -1,  236,   -1,  237,
       238,   -1,  239,   -1,  240, -167,   -2,  241,
        -1,  242,   -1,   -1,  243,   -1,  244,  245,
        -1,  246,  247,  248,  249,   -1,  250,   -1,
       251,  252,   -1,  253,  254,  255,   -1,   -1,
       256,   -1,  257,  258,   -1,  259,   -1,  260,
       261,   -1,  262,   -1,  263,  264,   -1,  265,
        -1,  266,  267,   -1,  268,   -1,  269,  270,
        -1,  271,   -1,  272,  273,   -1,  274,   -1,
       275,  276,   -1,  277,   -1,  278,   -1,   -1,
       279,   -1,  280,   -1,   -1,  281,   -1,  282,
        -1,   -1,  283,   -1,  284,   -1,   -1,  285,
        -1,  286,   -1,   -1,  287,   -1,  288,   -1,
        -1,  289,   -1,  290,  291,   -1,  292,   -1,
       293,   -1,   -1,  294,   -1,  295,  296,   -1,
       297,   -1,  298,   -1,   -1,  299,   -1,  300,
        -1,   -1,  301,   -1,  302,   -1,   -1,  303,
        -1,  304,   -1,   -1,  305,   -1, -952,  -94,
        -2,  308,   -1,  309,   -1,   -1,   -1,   -1,
       310,   -1,   -1,  311,   -1,  312,   -1,   -1,
       313,   -1,  314,   -1,   -1,  315,   -1,  316,
        -1,   -1,  317,   -1,  318,   -1,   -1,  319,
        -1,  320,   -1,   -1,  321,   -1,  322,   -1,
        -1,  323,   -1,  324,   -1,   -1,  325,  326,
       327,   -1,   -1,  328,   -1,  329,  330,   -1,
       331,   -1,  332,   -1,   -1,  333,   -1,  334,
        -1,   -1,   -1,   -1,  335,  336,   -1,  337,
        -1,  338,   -1,   -1,  339,   -1,  340,   -1,
        -1,   -1,   -1,  341,   -1,   -1,  342,   -1,
       343,   -1,   -1,   -1,   -1,  344,   -1,   -1,
        -1,   -1,  345,   -1,   -1,  346,   -1,  347,
        -1,   -1,  348,   -1,  349,   -1,   -1,  350,
        -1,  351,  352,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,  353,   -1,   -1,  354,   -1,
       355,   -1,   -1,   -1,   -1,  356,   -1,   -1,
       357,   -1,  358,   -1,   -1,   -1,   -1,  359,
        -1,   -1,   -1,   -1,  360,  361,   -1,   -1,
        -1,  362,   -1,   -1,   -1,   -1,  363,   -1,
        -1,  364,   -1,  365,   -1,   -1,  366,   -1,
       367,   -1,   -1,  368,   -1,   -1,   -1,   -1,
        -1,   -1,  369,   -1,   -1,  370,   -1,  371,
        -1,   -1,  372,   -1,   -1,   -1,   -1,   -1,
        -1,  373,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,  374,   -1,  375,   -1,   -1,  376,   -1,
       377,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,  378,
        -1,   -1,  379,   -1,  380,   -1,   -1,   -1,
        -1,  381,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,  382,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,  383,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,  384,   -1,   -1,
        -1,   -1,   -1,   -1,  385,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,  386,   -1,   -1,   -1,   -1,   -1,   -1,
       387,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,  388,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,  389,   -1,   -1,   -1,   -1,
       390,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
       391,   -1,  392,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,  393,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,  394,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,  395,   -1,   -1,   -1,   -1,
       396,   -1,  397,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,  398,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,  399
    };

  if (len <= MAX_WORD_LENGTH && len >= MIN_WORD_LENGTH)
    {
      register int key = gbHash (str, len);

      if (key <= MAX_HASH_VALUE && key >= 0)
        {
          register int index = lookup[key];

          if (index >= 0)
            {
              register const char *s = wordlist[index].name;

              if (*str == *s && !strncmp (str + 1, s + 1, len - 1))
                return &wordlist[index];
            }
          else if (index < -TOTAL_KEYWORDS)
            {
              register int offset = - 1 - TOTAL_KEYWORDS - index;
              register const struct charHz *wordptr = &wordlist[TOTAL_KEYWORDS + lookup[offset]];
              register const struct charHz *wordendptr = wordptr + -lookup[offset + 1];

              while (wordptr < wordendptr)
                {
                  register const char *s = wordptr->name;

                  if (*str == *s && !strncmp (str + 1, s + 1, len - 1))
                    return wordptr;
                  wordptr++;
                }
            }
        }
    }
  return 0;
}

/* ANSI-C code produced by gperf version 2.7.1 (19981006 egcs) */
/* Command-line: gperf -L ANSI-C -I -t -H b5Hash -N inBig5 -C -E -o -n -c -D b5percent.txt  */
/****************************************************
 400 Most frequently used BIG5 chars in GB code space.
 The percentage is taken over all BIG5 code space.
****************************************************/

/* maximum key range = 986, duplicates = 4 */

#ifdef __GNUC__
__inline
#endif
static unsigned int
b5Hash (register const char *str, register unsigned int len)
{
  static const unsigned short asso_values[] =
    {
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986, 986, 986, 986, 986, 986, 986, 986, 986, 986,
      986,  81,   0, 166,   0,  55,  35,   5, 396,  21,
      116,  80, 265,  19, 986, 311,  28,  25, 345, 105,
      215,  95,  10, 415,  30, 468,  40, 110, 330,  80,
      155, 480, 180, 333,  21, 498, 188, 190,  89, 453,
      200, 228, 380,  13, 436, 475,  11, 278, 273, 430,
      280, 340, 120, 236, 183, 296, 488, 500, 456, 356,
      246, 120,  64, 491,  78, 285, 163, 461, 418, 288,
        4, 510, 326, 438, 383, 478,  76, 135, 330, 260,
      495,  45,  33,   1,  73, 501, 380, 433, 348, 505,
      425, 363,  23, 206, 195, 986
    };
  return asso_values[(unsigned char)str[len - 1]] + asso_values[(unsigned char)str[0]];
}

#ifdef __GNUC__
__inline
#endif
static const struct charHz *
inBig5 (register const char *str, register unsigned int len)
{
  enum
    {
      TOTAL_KEYWORDS = 400,
      MIN_WORD_LENGTH = 2,
      MAX_WORD_LENGTH = 2,
      MIN_HASH_VALUE = 0,
      MAX_HASH_VALUE = 985
    };

  static const struct charHz wordlist[] =
    {
      {"い",	0.769287},
      {"ぇ",	0.306841},
      {"Г",	0.019016},
      {"",	0.088828},
      {"钉",	0.065464},
      {"ざ",	0.031305},
      {"の",	0.112574},
      {"锭",	0.028211},
      {"",	0.046708},
      {"",	0.015041},
      {"き",	0.071498},
      {"抖",	0.025611},
      {"端",	0.035635},
      {"堡",	0.016753},
      {"搂",	0.018038},
      {"ぐ",	0.160736},
      {"辨",	0.090439},
      {"じ",	0.058479},
      {"堵",	0.037804},
      {"を",	0.015738},
      {"滤",	0.014759},
      {"",	0.229607},
      {"栋",	0.034256},
      {"",	0.166304},
      {"ず",	0.093519},
      {"侣",	0.018394},
      {"杆",	0.045773},
      {"ゑ",	0.147260},
      {"甭",	0.017462},
      {"λ",	0.055894},
      {"腑",	0.015586},
      {"北",	0.018907},
      {"何",	0.019326},
      {"更",	0.015277},
      {"Ν",	0.039054},
      {"ア",	0.049332},
      {"ン",	0.057086},
      {"",	0.043716},
      {"ユ",	0.423518},
      {"Ρ",	0.038273},
      {"憨",	0.016983},
      {"蛤",	0.065455},
      {"ま",	0.043318},
      {"Ω",	0.137466},
      {"ノ",	0.404486},
      {"",	0.027452},
      {"м",	0.031913},
      {"焊",	0.022180},
      {"",	0.108684},
      {"キ",	0.064182},
      {"",	0.066723},
      {"れ",	0.023091},
      {"そ",	0.113864},
      {"ъ",	0.021874},
      {"遏",	0.015441},
      {"芥",	0.037946},
      {"Ы",	0.028469},
      {"А",	0.014519},
      {"て",	0.069696},
      {"ウ",	0.093334},
      {"丁",	0.128990},
      {"",	0.070255},
      {"さ",	0.083516},
      {"锣",	0.072818},
      {"掸",	0.016109},
      {"陆",	0.018793},
      {"隔",	0.135395},
      {"恨",	0.098976},
      {"兜",	0.022989},
      {"薄",	0.185013},
      {"虫",	0.067999},
      {"せ",	0.041783},
      {"",	0.169524},
      {"呼",	0.098767},
      {"逼",	0.035493},
      {"冻",	0.031729},
      {"Α",	0.117938},
      {"迭",	0.019888},
      {"钡",	0.079914},
      {"骸",	0.041485},
      {"蹈",	0.018574},
      {"陈",	0.016470},
      {"ヴ",	0.068123},
      {"郸",	0.014632},
      {"嘲",	0.019986},
      {"カ",	0.061454},
      {"ァ",	0.060330},
      {"话",	0.016134},
      {"Τ",	1.331823},
      {"或",	0.311471},
      {"睫",	0.014513},
      {"澈",	0.033989},
      {"单",	0.103263},
      {"获",	0.127011},
      {"届",	0.029026},
      {"洁",	0.015288},
      {"偿",	0.025526},
      {"も",	0.137685},
      {"セ",	0.205378},
      {"ぃ",	1.647294},
      {"р",	0.114942},
      {"",	0.049163},
      {"オ",	0.023332},
      {"垛",	0.029635},
      {"到",	0.022240},
      {"戮",	0.030851},
      {"だ",	0.141643},
      {"ぶ",	0.120274},
      {"辰",	0.028860},
      {"场",	0.102537},
      {"е",	0.092950},
      {"独",	0.051303},
      {"弧",	0.371579},
      {"浪",	0.014627},
      {"称",	0.046636},
      {"福",	0.049927},
      {"",	0.063111},
      {"と",	0.019307},
      {"Γ",	0.019892},
      {"衡",	0.082802},
      {"崩",	0.037599},
      {"",	0.069500},
      {"腊",	0.046553},
      {"栏",	0.022982},
      {"氮",	0.039860},
      {"谋",	0.125828},
      {"ご",	0.027650},
      {"洱",	0.014572},
      {"炳",	0.035152},
      {"尿",	0.028902},
      {"褐",	0.030283},
      {"炊",	0.018765},
      {"次",	0.037953},
      {"ど",	0.015175},
      {"惠",	0.052447},
      {"饼",	0.016471},
      {"ダ",	0.018525},
      {"穿",	0.016991},
      {"ブ",	0.016309},
      {"幢",	0.023295},
      {"",	0.210737},
      {"钮",	0.109895},
      {"墩",	0.019304},
      {"打",	0.016478},
      {"",	0.120442},
      {"吏",	0.029056},
      {"春",	0.017140},
      {"盾",	0.205663},
      {"干",	0.021996},
      {"尘",	0.026937},
      {"",	0.100132},
      {"街",	0.076828},
      {"э",	0.074701},
      {"刚",	0.070771},
      {"荷",	0.033967},
      {"ゴ",	0.135818},
      {"常",	0.286923},
      {"烩",	0.021442},
      {"驹",	0.066187},
      {"杠",	0.154665},
      {"は",	0.066513},
      {"ひ",	0.019366},
      {"",	0.092406},
      {"牡",	0.019427},
      {"莱",	0.143276},
      {"裕",	0.019852},
      {"ゅ",	0.378802},
      {"阑",	0.029765},
      {"フ",	0.060734},
      {"某",	0.060089},
      {"传",	0.047633},
      {"ぷ",	0.017041},
      {"毙",	0.142548},
      {"Μ",	0.041400},
      {"ボ",	0.036977},
      {"毕",	0.030253},
      {"币",	0.014722},
      {"弄",	0.041732},
      {"妮",	0.023904},
      {"洛",	0.024133},
      {"荡",	0.034493},
      {"吹",	0.031733},
      {"く",	0.017932},
      {"盒",	0.036924},
      {"σ",	0.086345},
      {"秸",	0.036020},
      {"合",	0.014800},
      {"ガ",	0.015329},
      {"动",	0.039660},
      {"",	0.021045},
      {"淮",	0.029324},
      {"よ",	0.180739},
      {"バ",	0.020917},
      {"ゎ",	0.021087},
      {"ψ",	0.016450},
      {"ち",	0.034270},
      {"ヒ",	0.023452},
      {"び",	0.135500},
      {"痴",	0.022743},
      {"妓",	0.175203},
      {"в",	0.029011},
      {"溃",	0.025235},
      {"钵",	0.020801},
      {"叫",	0.335331},
      {"谅",	0.159704},
      {"奔",	0.043805},
      {"参",	0.082474},
      {"揭",	0.041141},
      {"",	0.070902},
      {"",	0.019910},
      {"虏",	0.029031},
      {"睦",	0.016313},
      {"馒",	0.018368},
      {"赣",	0.125698},
      {"兵",	0.034810},
      {"τ",	0.267319},
      {"阶",	0.112807},
      {"承",	0.018520},
      {"拨",	0.030641},
      {"矗",	0.348555},
      {"旧",	0.036569},
      {"ゼ",	0.056596},
      {"港",	0.016607},
      {"チ",	0.122909},
      {"翅",	0.054052},
      {"",	0.268859},
      {"耕",	0.094117},
      {"来",	0.024633},
      {"琵",	0.096599},
      {"ゲ",	0.065257},
      {"拒",	0.021939},
      {"蝴",	0.019991},
      {"宾",	0.014644},
      {"借",	0.030914},
      {"郎",	0.062679},
      {"冀",	0.015188},
      {"ホ",	0.021828},
      {"戈",	0.649007},
      {"κ",	0.037749},
      {"朝",	0.072864},
      {"や",	0.053675},
      {"计",	0.093825},
      {"阀",	0.034648},
      {"化",	0.018468},
      {"т",	0.097010},
      {"斗",	0.031320},
      {"辅",	0.034071},
      {"拘",	0.017071},
      {"ぱ",	0.331414},
      {"Θ",	0.236619},
      {"",	0.017806},
      {"а",	0.033741},
      {"跑",	0.071342},
      {"ら",	0.158870},
      {"挡",	0.075241},
      {"",	0.082499},
      {"跌",	0.050505},
      {"秤",	0.037712},
      {"堕",	0.033770},
      {"渤",	0.026064},
      {"帝",	0.122616},
      {"厨",	0.072859},
      {"瞒",	0.036769},
      {"毖",	0.023777},
      {"ぺ",	0.018066},
      {"蝶",	0.024433},
      {"秆",	0.105024},
      {"и",	1.503535},
      {"肚",	0.059178},
      {"ρ",	0.115500},
      {"柑",	0.106853},
      {"囊",	0.072786},
      {"伐",	0.028320},
      {"躲",	0.024624},
      {"Ч",	0.080762},
      {"ね",	0.124968},
      {"る",	0.103272},
      {"刮",	0.036130},
      {"",	0.084656},
      {"壁",	0.023113},
      {"щ",	0.054908},
      {"パ",	0.095309},
      {"",	0.057877},
      {"皇",	0.015462},
      {"み",	0.259234},
      {"克",	0.030173},
      {"方",	0.028259},
      {"贰",	0.025462},
      {"腹",	0.081804},
      {"ю",	0.019704},
      {"",	0.037346},
      {"",	0.172006},
      {"",	0.062596},
      {"",	0.042139},
      {"睹",	0.030141},
      {"窖",	0.017032},
      {"玻",	0.033712},
      {"贾",	0.097897},
      {"",	0.019585},
      {"边",	0.036788},
      {"弘",	0.040640},
      {"烦",	0.021701},
      {"牧",	0.015084},
      {"帽",	0.019035},
      {"环",	0.046922},
      {"蛮",	0.033282},
      {"贺",	0.142554},
      {"ネ",	0.350021},
      {"铬",	0.020720},
      {"材",	0.117753},
      {"タ",	0.155168},
      {"好",	0.027903},
      {"嘿",	0.034138},
      {"程",	0.195193},
      {"ヘ",	0.091897},
      {"醇",	0.025892},
      {"ミ",	0.092087},
      {"戳",	0.098278},
      {"讽",	0.206358},
      {"ッ",	0.035629},
      {"酵",	0.037969},
      {"快",	0.059885},
      {"忌",	0.017369},
      {"泊",	0.041338},
      {"辽",	0.042914},
      {"倒",	0.110517},
      {"ョ",	0.024560},
      {"悔",	0.023162},
      {"攀",	0.023874},
      {"年",	0.020609},
      {"彻",	0.227495},
      {"钩",	0.141367},
      {"矫",	0.015495},
      {"菌",	0.022215},
      {"舱",	0.056262},
      {"地",	0.151584},
      {"砍",	0.061118},
      {"诀",	0.272770},
      {"尺",	0.085263},
      {"爹",	0.016105},
      {"夹",	0.053881},
      {"放",	0.021204},
      {"初",	0.093396},
      {"厩",	0.469347},
      {"家",	0.020237},
      {"沮",	0.034130},
      {"基",	0.059852},
      {"俱",	0.043658},
      {"残",	0.017357},
      {"竟",	0.045179},
      {"拈",	0.023371},
      {"砰",	0.110726},
      {"册",	0.020201},
      {"代",	0.024993},
      {"沧",	0.029663},
      {"估",	0.032246},
      {"攫",	0.015996},
      {"陪",	0.026776},
      {"加",	0.027477},
      {"布",	0.039371},
      {"美",	0.016772},
      {"蕾",	0.014455},
      {"灿",	0.024243},
      {"魁",	0.048220},
      {"沸",	0.027036},
      {"孽",	0.019130},
      {"犁",	0.022422},
      {"摸",	0.045496},
      {"纯",	0.054332},
      {"喷",	0.042048},
      {"荐",	0.030469},
      {"瘤",	0.042275},
      {"馋",	0.016165},
      {"癸",	0.291129},
      {"匡",	0.094920},
      {"瓜",	0.043175},
      {"挂",	0.025828},
      {"龄",	0.016134},
      {"酚",	0.034991},
      {"孔",	0.020823},
      {"靡",	0.035779},
      {"胯",	0.018547},
      {"法",	0.023479},
      {"量",	0.045329},
      {"临",	0.297640},
      {"策",	0.028177},
      {"螟",	0.085551},
      {"龟",	0.153848},
      {"非",	0.037319},
      {"闽",	0.129670},
      {"窥",	0.049393},
      {"娩",	0.042645},
      {"块",	0.030758},
      {"冠",	0.041439},
      {"醚",	0.042696},
      {"霉",	0.028028},
      {"辊",	0.019105},
      {"窟",	0.052699},
      {"棵",	0.014792},
      {"岿",	0.098239}
    };

  static const short lookup[] =
    {
         0,   -1,   -1,   -1,   -1, -408,    3, -399,
        -2,   -1, -413,    6, -396,   -2,   -1,    7,
         8,   -1,    9,   10,   11,   -1,   -1,   12,
        -1,   13,   14,   -1,   15,   16,   17,   18,
        -1,   19,   20,   -1,   21,   -1,   22,   23,
        24,   -1,   25,   26,   -1,   27,   28,   -1,
        29,   30,   31,   32,   -1,   33,   34,   35,
        36,   -1,   37,   38,   39,   40,   -1,   41,
        42,   43,   44,   -1,   45,   46,   47,   -1,
        -1,   48,   49,   50,   51,   -1,   -1,   -1,
        52,   53,   -1,   54,   55,   56,   57,   -1,
        -1,   58,   59,   60,   -1,   -1,   61,   62,
        -1,   -1,   -1,   63,   64,   65,   -1,   66,
        67,   68,   69,   -1,   -1,   70,   71,   72,
        -1,   73,   74,   75,   76,   -1,   77,   -1,
        78,   79,   -1,   -1,   -1,   80,   81,   -1,
        82,   -1,   83,   -1,   -1,   84,   -1,   85,
        86,   -1,   87,   -1,   88,   -1,   -1,   89,
        90,   91,   -1,   -1,   -1,   -1,   92,   -1,
        -1,   -1,   -1,   93,   94,   -1,   95,   -1,
        96,   -1,   -1,   97,   -1,   98,   99,   -1,
       100,   -1,  101,  102,   -1,  103,   -1,  104,
       105,   -1,   -1,   -1,  106,   -1,   -1,  107,
        -1,  108,  109,   -1,  110,   -1,  111,  112,
        -1,  113,  114,   -1,  115,   -1,  116,   -1,
       117,  118,   -1,  119,   -1,  120,  121,   -1,
       122,   -1,  123,  124,   -1,  125,   -1,  126,
       127,   -1,   -1,   -1,  128,  129,   -1,  130,
        -1,  131,  132,   -1,  133,   -1,  134,  135,
        -1,   -1,   -1,  136,  137,   -1,  138,   -1,
       139,  140,   -1,   -1,   -1,  141,  142,   -1,
       143,   -1,  144,   -1,   -1,  145,   -1,  146,
       147,   -1,  148,   -1,  149,  150,   -1,  151,
        -1,  152,  153,   -1,  154,   -1,  155,  156,
        -1,  157,   -1,  158,  159,   -1,  160,   -1,
       161,  162,   -1,  163,   -1,  164,  165,   -1,
       166,   -1,  167,  168,   -1,  169,   -1,  170,
       171,   -1,  172,   -1,  173,  174,   -1,  175,
        -1,  176,  177,   -1,  178,  179, -737,  182,
        -1,  183,   -1,  184,  185,   -1,  186,   -1,
       187,  188,   -1,  189,   -1,  190,  191,   -1,
       192,   -1,  193,  194,   -1,  195,   -1,  196,
      -220,   -2,   -1,   -1,  197,  198,   -1,  199,
        -1,  200,  201,   -1,   -1,   -1,  202,   -1,
        -1,  203,  204,  205,  206,   -1,   -1,   -1,
       207,  208,   -1,  209,   -1,   -1,  210,   -1,
       211,  212,  213,   -1,   -1,  214,   -1,  215,
       216,   -1,  217,   -1,  218,  219,   -1,  220,
        -1,  221,  222,   -1,  223,   -1,  224,  225,
        -1,  226,   -1,  227,  228,   -1,   -1,   -1,
       229,  230,   -1,  231,   -1,  232,  233,   -1,
       234,   -1,  235,  236,   -1,  237,   -1,  238,
       239,   -1,  240,  241,  242,  243,   -1,  244,
        -1,  245,  246,   -1,  247,   -1,  248,  249,
        -1,  250,   -1,  251,  252,   -1,  253,   -1,
       254,  255,   -1,  256,   -1,  257,   -1,   -1,
       258,   -1,  259,  260,   -1,  261,  262,  263,
       264,   -1,  265,   -1,  266,  267,   -1,  268,
        -1,  269,  270,   -1,  271,   -1,  272,  273,
        -1,  274,   -1,  275,   -1,   -1,  276,  277,
       278,  279,   -1,  280,   -1,  281,   -1,   -1,
       282,   -1,  283,  284,   -1,  285,   -1,  286,
       287,   -1,  288,   -1,  289,  290,   -1,  291,
        -1,  292,  293,   -1,  294,   -1,  295,  296,
        -1,  297,   -1,  298,  299,   -1,  300,   -1,
       301,  302,   -1,  303,   -1,  304,  305,   -1,
       306,   -1,  307,  308,   -1,  309,   -1,  310,
        -1,   -1,  311,   -1,  312,  313,   -1,  314,
        -1,  315,  316,   -1,  317,   -1,  318,   -1,
        -1,  319,   -1,  320,  321,   -1,  322,   -1,
       323,  324,   -1,  325,   -1,  326,  327,   -1,
        -1,   -1,  328,  329,   -1, -975,  -70,   -2,
        -1,   -1,  332,   -1,  333,  334,   -1,  335,
        -1,  336,   -1,   -1,  337,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,  338,   -1,   -1,   -1,
       339,   -1,   -1,  340,   -1,  341,  342,   -1,
       343,   -1,  344,  345,   -1,   -1,   -1,  346,
       347,   -1,  348,   -1,   -1,   -1,   -1,  349,
        -1,   -1,  350,   -1,  351,   -1,  352,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
       353,  354,   -1,   -1,   -1,   -1,   -1,   -1,
       355,   -1,  356,  357,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,  358,   -1,
        -1,   -1,   -1,  359,   -1,   -1,  360,   -1,
       361,   -1,   -1,   -1,   -1,  362,  363,   -1,
       364,  365,  366,   -1,   -1,  367,   -1,  368,
        -1,   -1,   -1,   -1,  369,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,  370,   -1,
        -1,  371,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,  372,   -1,   -1,
       373,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,  374,   -1,   -1,   -1,
        -1,   -1,  375,   -1,  376,   -1,   -1,  377,
        -1,   -1,   -1,  378,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
       379,   -1,  380,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,  381,   -1,
        -1,   -1,   -1,  382,   -1,  383,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,  384,   -1,   -1,  385,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,  386,   -1,
        -1,   -1,   -1,  387,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,  388,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,  389,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,  390,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,  391,   -1,  392,   -1,
        -1,   -1,   -1,   -1,  393,   -1,   -1,   -1,
       394,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
        -1,   -1,   -1,   -1,   -1,   -1,  395,   -1,
        -1,  396,   -1,  397,   -1,   -1,   -1,   -1,
        -1,   -1,  398,   -1,   -1,   -1,   -1,   -1,
        -1,  399
    };

  if (len <= MAX_WORD_LENGTH && len >= MIN_WORD_LENGTH)
    {
      register int key = b5Hash (str, len);

      if (key <= MAX_HASH_VALUE && key >= 0)
        {
          register int index = lookup[key];

          if (index >= 0)
            {
              register const char *s = wordlist[index].name;

              if (*str == *s && !strncmp (str + 1, s + 1, len - 1))
                return &wordlist[index];
            }
          else if (index < -TOTAL_KEYWORDS)
            {
              register int offset = - 1 - TOTAL_KEYWORDS - index;
              register const struct charHz *wordptr = &wordlist[TOTAL_KEYWORDS + lookup[offset]];
              register const struct charHz *wordendptr = wordptr + -lookup[offset + 1];

              while (wordptr < wordendptr)
                {
                  register const char *s = wordptr->name;

                  if (*str == *s && !strncmp (str + 1, s + 1, len - 1))
                    return wordptr;
                  wordptr++;
                }
            }
        }
    }
  return 0;
}

static int j_code3(const char * buff, int count)
{
	const unsigned char *phz;
	double c_gb, c_b5;		/* Frequency count for char */
//	double o_gb, o_b5;		/* Holes in opposit encode.*/
					/* If we test user defined chars. */
	const struct charHz * temphz;	/* temperary char frequency. */

	c_gb = c_b5 = 0;

	for(phz=(unsigned char * /*FIXIT*/)buff; (int)phz < ((int)buff + count); phz++){
		if(*phz & 0x80){
			/* First Byte not in GB range. 
			 * We don't do user defined chars. 
			 * Should not simply return if we consider
			 * user defined chars
			 * */
			if((*phz >= 0xF8 && *phz <= 0xF9) && ( (*(phz+1) >= 0x40 && *(phz+1) <= 0x7E) || (*(phz+1) >= 0xA1 && *(phz+1) <= 0xFE ))){
				return BIG5_CODE;
			}
			/* Second Byte not in GB range. */
			if ((*phz >= 0xA1 && *phz <= 0xF7) && (* (phz+1) >= 0x40 && *(phz+1) <= 0x7E)){

				return BIG5_CODE;
			}
			/* GB holes in first byte: 0xA8-0xAF. */
			if((*phz >= 0xA8 && *phz <= 0xAF) && ((*(phz+1) >= 0x40 && *(phz+1) <= 0x7E ) || (*(phz+1) >= 0xA1 && *(phz+1) <= 0xFE ))){

				return BIG5_CODE;
			}

			/* Valid GB and BIG5? see which one is more likely. */
			if ((*phz >= 0xA1 && *phz <= 0xF7) && (* (phz+1) >= 0xA1 && *(phz+1) <= 0xFE)){

				temphz = inGB((char * /*FIXIT*/)phz, 2);
				if(temphz)
					c_gb += temphz->percent;

				temphz = inBig5((char * /*FIXIT*/)phz, 2);
				if(temphz)
					c_b5 += temphz->percent;

				/* Every valid GB and BIG5 codes
				 * are tested. we jump 2 here.
				 */
				phz++;
			}
		}
		/* Anything else are either ASCII or screwed
		 * text. We pass that one char. 
		 */
	} /* for loop end */
	
#ifdef DEBUG
printf("GB = %f, \t BIG5 = %f\n", c_gb, c_b5);
#endif

	/* Assume that == is GB code. Prove me wrong! :) */
	if( c_gb >= c_b5 )
		return GB_CODE;
	else
		return BIG5_CODE;
}

/*
 *This function replaced by j_code3
 *2000.8.31
 *Yu Guanghui <ygh@dlut.edu.cn>
 */
/*
int j_code2(char * buff,int count)
{
	unsigned char * phz;
	int c_gb=0;
	
	for(phz=buff;phz<(buff+count);phz++){
		if(*phz & 0x80){
			if ((*phz >= 0xF8 && *phz <= 0xF9) && ( (*(phz+1) >= 0x40 && *(phz+1) <= 0x7E) || (*(phz+1) >= 0xA1 && *(phz+1) <= 0xFE ))){
				return BIG5_CODE;
			}
			if ((*phz >= 0xA1 && *phz <= 0xF7) && (* (phz+1) >= 0x40 && *(phz+1) <= 0x7E)){
				return BIG5_CODE;
			}
			if ((*phz >= 0xA1 && *phz <= 0xF7) && (* (phz+1) >= 0xA1 && *(phz+1) <= 0xFE)){
				c_gb++;
			}
			phz++;
			continue;
		}
	}

	if( c_gb ==0 ){
		return OTHER_CODE;
	}else {
		return GB_CODE;
	}

}
*/
